<style>
	body {
		margin: 0px;
	}
</style>

<canvas>
</canvas>

<script>
	var canvas = document.querySelector("canvas");
	var ctx = canvas.getContext('2d');
	
	canvas.width = 600;
	canvas.height = 630;
	
//

var mat = [
	[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	[2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 3, 3, 3, 0, 3, 2, 2, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 2, 2, 3, 0, 3, 3, 3, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 2],
	[2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2],
	[2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2],
	[ , 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,  ],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 4, 4, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2,  ,  ,  ,  ,  ,  , 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2,  ,  ,  ,  ,  ,  , 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 3, 3, 3, 3, 3, 2, 2, 3, 2,  ,  ,  ,  ,  ,  , 2, 3, 2, 2, 3, 3, 3, 3, 3, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 3, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 3, 3, 2],
	[2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2],
	[2, 2, 2, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3, 2, 2, 2],
	[ , 3, 3, 3, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3, 3, 3,  ],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 3, 3, 3, 0, 0, 3, 3, 3, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2],
	[2, 3, 3, 3, 3, 3, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 3, 3, 3, 3, 3, 2],
	[2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2],
	[2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 2, 3, 2, 2, 3, 2],
	[2, 3, 2, 2, 3, 0, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 2, 2, 3, 3, 3, 3, 0, 3, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 3, 2],
	[2, 3, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 3, 2],
	[2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2],
	[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],	
];

//0, 1, 3, 4
var color = ["blue", "red", "black", "yellow", "gray"];
var size = 20;

function drawStage(mat, nr, nc) {
	for(var j = 0; j < nr; j++)
		for(var i = 0; i < nc; i++){
			if(mat[j][i] == 2) {
				ctx.fillStyle = color[2];
				ctx.fillRect(i*size, j*size, size, size);
			}
			else if(mat[j][i] == 'f') {
				ctx.fillStyle = color[1];
				ctx.save();
				ctx.translate(size*i + size/2,size*j + size/2);
				ctx.rotate(Math.PI / 4);
				ctx.fillRect(-size/2 + size/8, -size/2 + size/8, size-size/4, size-size/4);
				ctx.restore();
			}
			else if(mat[j][i] == 0) {
				ctx.fillStyle = color[0];
				ctx.beginPath();
				ctx.arc(size*i + size/2,size*j + size/2, size/4,0,2*Math.PI);
				ctx.fill();
				ctx.closePath();
			}
			else if(mat[j][i] == 3) {
				ctx.fillStyle = color[3];
				ctx.fillRect(i*size + 3*size/8, j*size + 3*size/8, size/4, size/4);
			}
			else if(mat[j][i] == 4) {
				ctx.fillStyle = color[4];
				ctx.fillRect(i*size, j*size, size, size/4);
			}
		}
}

var pacman = {
	x: 1,
	y: 1,
	direction: "left",
	
	draw: function() {
		ctx.fillStyle = "red";
		ctx.beginPath();
		ctx.arc(size*this.x + size/2,size*this.y + size/2, size/2,0,2*Math.PI);
		ctx.fill();
		ctx.closePath();
	},
	
	move: function() {
		var x = this.x;
		var y = this.y;
		switch(this.direction) {
			case 37:
				this.x--;
				break;
			case 38:
				this.y--;
				break;
			case 39:
				this.x++;
				break;
			case 40:
				this.y++;
				break;
		}
		if(mat[this.y][this.x] == 2) {
			this.x = x;
			this.y = y;
		}
	}
};


addEventListener('keydown', function(event) {
	switch(event.keyCode) {
		case 37:
			if(mat[pacman.y][pacman.x - 1] != 2) {
				pacman.direction = event.keyCode;
			}
			break;

		case 38:
			if(mat[pacman.y - 1][pacman.x] != 2) {
				pacman.direction = event.keyCode;
			}
			break;

		case 39:
			if(mat[pacman.y][pacman.x + 1] != 2) {
				pacman.direction = event.keyCode;
			}
			break;

		case 40:
			if(mat[pacman.y + 1][pacman.x] != 2) {
				pacman.direction = event.keyCode;
			}
			break;
	}
});



function draw() {
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	drawStage(mat, mat.length, mat[0].length);
	pacman.draw();
	pacman.move();
	setTimeout(draw, 1000 / 8);
}

draw();
//
</script>
